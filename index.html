function generatePDF(kidName, schedule) {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ orientation: "landscape" });

  const pageWidth = doc.internal.pageSize.getWidth();
  const pageHeight = doc.internal.pageSize.getHeight();

  // Helper to remove leading emoji so PDF fonts don't glitch
  function cleanChoreName(name) {
    if (!name) return "";
    let text = name;
    if (text.charCodeAt(0) > 255) {
      // drop the first 1–2 characters if it's an emoji
      text = text.slice(2).trim();
    }
    return text || name;
  }

  // === HEADER ===
  doc.setFont("helvetica", "bold");
  doc.setFontSize(26);
  doc.setTextColor(255, 179, 0);
  doc.text("SUPER KID CHORE QUEST", pageWidth / 2, 20, { align: "center" });

  doc.setFontSize(20);
  doc.setTextColor(0, 0, 0);
  doc.text(`${kidName}'s Weekly Chore Schedule`, pageWidth / 2, 32, {
    align: "center",
  });

  // === BUILD DAY → CHORES MAP ===
  const dayChores = {};
  DAYS.forEach((d) => (dayChores[d] = []));
  Object.keys(schedule).forEach((chore) => {
    const pretty = cleanChoreName(chore);
    (schedule[chore] || []).forEach((day) => {
      if (dayChores[day]) {
        if (!dayChores[day].includes(pretty)) {
          dayChores[day].push(pretty);
        }
      }
    });
  });

  // === LAYOUT: COLORED BOXES FOR EACH DAY ===
  const topDays = ["Mon", "Tue", "Wed", "Thu"];
  const bottomDays = ["Fri", "Sat", "Sun"];

  const boxMarginX = 15;
  const boxWidthTop =
    (pageWidth - boxMarginX * 2 - 10 * (topDays.length - 1)) / topDays.length;
  const boxWidthBottom =
    (pageWidth - boxMarginX * 2 - 10 * (bottomDays.length - 1)) /
    bottomDays.length;
  const boxHeight = 65;

  const startTopY = 45;
  const startBottomY = startTopY + boxHeight + 15;

  const colors = [
    { r: 255, g: 179, b: 186 },
    { r: 255, g: 223, b: 186 },
    { r: 255, g: 255, b: 186 },
    { r: 186, g: 255, b: 201 },
    { r: 186, g: 225, b: 255 },
    { r: 213, g: 186, b: 255 },
    { r: 255, g: 214, b: 255 },
  ];

  doc.setFontSize(12);
  doc.setTextColor(40, 40, 40);

  function drawDayBox(day, index, row, colorIndex) {
    const isTop = row === "top";
    const boxWidth = isTop ? boxWidthTop : boxWidthBottom;
    const x =
      boxMarginX + index * (boxWidth + 10); // 10mm gap between boxes
    const y = isTop ? startTopY : startBottomY;

    const c = colors[colorIndex % colors.length];

    // Box background
    doc.setFillColor(c.r, c.g, c.b);
    doc.setDrawColor(255, 179, 0);
    doc.setLineWidth(0.7);
    doc.roundedRect(x, y, boxWidth, boxHeight, 2, 2, "FD");

    // Day title
    doc.setFont("helvetica", "bold");
    doc.setFontSize(13);
    doc.setTextColor(60, 60, 60);
    doc.text(day, x + boxWidth / 2, y + 8, { align: "center" });

    // Chores list
    doc.setFont("helvetica", "normal");
    doc.setFontSize(11);
    doc.setTextColor(40, 40, 40);

    const choresForDay = dayChores[day] || [];
    let text;
    if (choresForDay.length === 0) {
      text = "— no chores —";
    } else {
      text = choresForDay.map((c) => "• " + c).join("\n");
    }

    const maxTextWidth = boxWidth - 6;
    const lines = doc.splitTextToSize(text, maxTextWidth);
    doc.text(lines, x + 3, y + 18);
  }

  // Draw top row
  topDays.forEach((day, i) => {
    drawDayBox(day, i, "top", i);
  });

  // Draw bottom row
  bottomDays.forEach((day, i) => {
    drawDayBox(day, i, "bottom", topDays.length + i);
  });

  // === FOOTER MESSAGE ===
  doc.setFont("helvetica", "italic");
  doc.setFontSize(11);
  doc.setTextColor(90, 90, 90);
  doc.text(
    `Keep up the awesome work, ${kidName}!`,
    pageWidth / 2,
    pageHeight - 10,
    { align: "center" }
  );

  doc.save("SuperKidSchedule.pdf");
}
